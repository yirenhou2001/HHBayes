% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/datasummary.R
\name{data_summarization}
\alias{data_summarization}
\title{Summarize infection episodes (per individual)}
\usage{
data_summarization(
  df = NULL,
  Household_ID = NULL,
  Individual_ID = NULL,
  Household_role = NULL,
  Sample_test_days = NULL,
  Infectious_status = NULL,
  Community_rate_infection = NULL,
  Covariate_DataFrame = NULL,
  covariate_cols = NULL
)
}
\arguments{
\item{df}{Data frame with at least the columns
\code{HH}, \code{individual_ID}, \code{role}, \code{test_date},
\code{infection_status}, \code{community_risk}. When \code{df} is supplied,
the vector arguments below are ignored.}

\item{Household_ID}{Integer vector. Household identifiers; used only when
\code{df} is \code{NULL}.}

\item{Individual_ID}{Integer vector. Individual identifiers; used only when
\code{df} is \code{NULL}.}

\item{Household_role}{Character vector. Household role for each row
(e.g., "infant", "sibling", "adult", "elder"); used only when \code{df} is \code{NULL}.}

\item{Sample_test_days}{Integer or numeric vector. Testing day index for each
record (relative day); used only when \code{df} is \code{NULL}.}

\item{Infectious_status}{Integer or logical vector (0/1). Test-time
infection indicator; used only when \code{df} is \code{NULL}.}

\item{Community_rate_infection}{Numeric vector. Community risk/intensity at
each record; used only when \code{df} is \code{NULL}.}

\item{Covariate_DataFrame}{Data frame of additional covariates to merge prior
to summarization. The join uses the best available keys among
\code{c("HH","individual_ID","test_date")}. At minimum, \code{individual_ID}
must be present (preferably with \code{HH} and/or \code{test_date}).}

\item{covariate_cols}{Character vector of covariate names to summarize
(after merging). If \code{NULL} (default), all non-core columns are summarized.}
}
\value{
A data frame with one row per individual containing:
\itemize{
\item \code{HH}: household identifier.
\item \code{individual_ID}: individual identifier (within-household).
\item \code{n.true.infection}: number of infection episodes (runs of 1's).
\item \code{n.detected.infection}: number of detected episodes (same as \code{n.true.infection} given \code{infection_status} encodes detection).
\item \code{infection.detected.start}: first positive day of the first episode.
\item \code{infection.detected.end}: last positive day of the first episode.
\item \code{infection.true.duration}: duration (days) of the first episode
based on test days (\code{end - start + 1}).
\item \code{last_negative}: last negative test day prior to the first positive (if any).
\item \code{infection.infectious.day}: comma-separated list of test-day indices
during the first episode.
\item \code{community.risk}: mean of \code{community_risk} across this individual's records.
\item \code{role}: household role (as observed).
}
If covariates are present, additional columns are appended per covariate (after
name normalization to snake_case):
\itemize{
\item \code{<cov>_mode}: mode for categorical/logical or binary-numeric covariates.
\item \code{<cov>_first}, \code{<cov>_mean}, \code{<cov>_last}: first observed, mean, and last observed value for numeric covariates.
\item \code{<cov>_timevarying}: logical flag indicating whether the covariate varies over time for the individual.
}
}
\description{
Aggregates long-format testing records into one row per individual with
episode counts, first/last positive within the first episode, inferred
infectious-day span, last pre-positive negative, and optional covariate
summaries. Accepts either a single data frame \code{df} containing the
six required core columns, or the six vectors individually. Optionally
merges an external covariate data frame before summarizing.
}
\details{
\itemize{
\item Either \code{df} or all six vector inputs must be provided; otherwise an error is thrown.
\item When merging \code{Covariate_DataFrame}, name collisions with the six core columns are avoided by renaming the colliding covariate columns with a \code{"_cv"} suffix.
\item Covariate names are normalized to snake_case prior to creating summary columns.
\item Records are internally ordered by \code{HH}, \code{individual_ID}, \code{test_date}.
\item Episode detection is based on runs of \code{infection_status == 1}; the first episode is used for \code{*_start}, \code{*_end}, \code{*_duration}, and \code{infection.infectious.day}.
}
}
\examples{
\dontrun{
# Minimal example with a data frame:
df <- data.frame(
  HH = c(1,1,1,1,1,1),
  individual_ID = c(1,1,1,2,2,2),
  role = c("infant","infant","infant","adult","adult","adult"),
  test_date = c(1,2,3,1,2,3),
  infection_status = c(0,1,1,0,0,1),
  community_risk = c(0.01,0.02,0.02,0.01,0.01,0.02)
)
data_summarization(df)

# With external covariates to merge and summarize:
covdf <- data.frame(
  HH = c(1,1), individual_ID = c(1,2),
  vacc_status = c(1,0), bmi = c(18.5, 27.2)
)
data_summarization(df, Covariate_DataFrame = covdf)
}

}
\seealso{
\code{\link{generate_synthetic_data_standardized}},
\code{\link{summarize_individuals}},
\code{\link{main_parameter_estimation_pipeline}}
}

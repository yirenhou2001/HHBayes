% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/main-pipeline.R
\name{main_parameter_estimation_pipeline}
\alias{main_parameter_estimation_pipeline}
\title{Main parameter estimation pipeline (simulate or analyze)}
\usage{
main_parameter_estimation_pipeline(
  user_data = NULL,
  synthetic_data = TRUE,
  engine = c("legacy", "rsv_vl"),
  estimation_method = c("mle", "stan"),
  n_households = 10,
  n_runs = 10,
  hh.size = sample(3:7, 1),
  tests.per.week = 1,
  Covariates = FALSE,
  Covariates_list = c("Vaccination status", "Antibody Level"),
  Covariate_specifications = NULL,
  day_series_covariates = TRUE,
  series_cols = NULL,
  comm_covariate_cols = NULL,
  hh_covariate_cols = NULL,
  hh_by_role = FALSE,
  hh_role_covariate_cols = NULL,
  standardize_covariates = TRUE,
  lambda_comm = 0.01,
  lambda_hh = 0.01,
  p.comm.base.infant.fix = 0.002,
  p.comm.multiplier.sibling = 1,
  p.comm.multiplier.parent = 1,
  p.comm.multiplier.elder = 1,
  p.hh.base.infant = 0.2,
  p.hh.multiplier.sibling = 0.5267686,
  p.hh.multiplier.parent = 0.8008933,
  p.hh.multiplier.elder = 0.6008933,
  p.imm.base.sibling = 1e-10,
  p.imm.base.parent = 1e-10,
  p.imm.base.elder = 1e-10,
  partial.immunity.infant = 1e-10,
  partial.immunity.sibling = 1e-10,
  partial.immunity.parent = 1e-10,
  partial.immunity.elder = 1e-10,
  duration.latent = 1,
  duration.infect.inf = 2,
  multiplier.dur.sibpar = 0.5,
  p.detect = 0.999,
  amplitude = 2.6581 * 0,
  phase = -0.408,
  start_date = as.Date("2024-09-21"),
  end_date = as.Date("2025-04-17"),
  latent_par = list(shape = 2, scale = 1),
  report_par = list(shape = 1, scale = 1.5),
  infect_par = list(shape = 3, scale = 2),
  start_par = c(-6, 0.02, -2, rep(0, 6)),
  lambda = 0.01,
  lambda0 = 0.2,
  lambda_alpha = 5,
  delta0_true = qlogis(0.002),
  alpha0_true = qlogis(0.2),
  seasonal_forcing_list = NULL,
  max_days = 365,
  stan_file = "HH_parameter_estimation2.stan",
  stan_chains = 1,
  stan_iter = 100,
  stan_warmup = 100,
  stan_control = list(adapt_delta = 0.99, max_treedepth = 20),
  stan_init = "random",
  stan_refresh = 50,
  stan_cores = 4
)
}
\arguments{
\item{user_data}{Optional; data.frame or list of data.frames as described in
\code{\link{TransmissionChainAnalysis}}.}

\item{synthetic_data}{Logical; if \code{TRUE}, simulate data internally.}

\item{engine}{Character; \code{"legacy"} or \code{"rsv_vl"}.}

\item{estimation_method}{Character; \code{"mle"} or \code{"stan"} (valid pairs:
\code{legacy+mle}, \code{rsv_vl+stan}).}

\item{n_households, n_runs}{Integers; simulation size and number of repeated runs (MLE only).}

\item{hh.size, tests.per.week}{Integers; simulation controls (legacy).}

\item{Covariates}{Logical; include synthetic covariates (legacy).}

\item{Covariates_list}{Character vector; covariate names (legacy).}

\item{Covariate_specifications}{Optional list; covariate generation controls (legacy).}

\item{day_series_covariates}{Logical; include day-series covariates (legacy+MLE).}

\item{series_cols}{Optional character vector; day-series columns (legacy+MLE).}

\item{comm_covariate_cols, hh_covariate_cols}{Optional character vectors; likelihood-level covariates (legacy+MLE).}

\item{hh_by_role}{Logical; fit separate HH effects by role (legacy+MLE).}

\item{hh_role_covariate_cols}{Optional named list; role-specific covariates (legacy+MLE).}

\item{standardize_covariates}{Logical; standardize covariates (legacy+MLE).}

\item{lambda_comm, lambda_hh}{Numeric; ridge penalties (legacy+MLE).}

\item{p.comm.base.infant.fix, p.comm.multiplier.sibling, p.comm.multiplier.parent, p.comm.multiplier.elder}{Numeric; community knobs (legacy).}

\item{p.hh.base.infant, p.hh.multiplier.sibling, p.hh.multiplier.parent, p.hh.multiplier.elder}{Numeric; within-HH knobs (legacy).}

\item{p.imm.base.sibling, p.imm.base.parent, p.imm.base.elder, partial.immunity.infant, partial.immunity.sibling, partial.immunity.parent, partial.immunity.elder}{Numeric; immunity knobs (legacy).}

\item{duration.latent, duration.infect.inf, multiplier.dur.sibpar}{Numeric; timing knobs (legacy).}

\item{p.detect}{Numeric; detection probability (legacy).}

\item{amplitude, phase}{Numeric; seasonality controls (legacy).}

\item{start_date, end_date}{\code{Date}; analysis window.}

\item{latent_par, report_par, infect_par}{Lists (shape, scale) for imputation (legacy+MLE).}

\item{start_par}{Numeric; optimizer start (legacy+MLE).}

\item{lambda, lambda0, lambda_alpha}{Numeric; optimizer penalties (legacy+MLE).}

\item{delta0_true, alpha0_true}{Numeric; reference values on logit scale (legacy+MLE).}

\item{seasonal_forcing_list}{Optional role-named list for seasonality (RSV/VL+Stan).}

\item{max_days}{Integer; maximum days (RSV/VL+Stan).}

\item{stan_file}{Path to a Stan model file.}

\item{stan_chains, stan_iter, stan_warmup}{Integers; Stan sampling controls.}

\item{stan_control}{List; Stan \code{control} list.}

\item{stan_init}{Character or function; Stan initialization.}

\item{stan_refresh}{Integer; Stan refresh.}

\item{stan_cores}{Integer; CPU cores for Stan.}
}
\value{
For legacy+MLE: list with \code{raw_simulation}, \code{summarized_data},
\code{person_day}, \code{estimates}, and \code{postprocessing}.
For RSV/VL+Stan: list with \code{raw_simulation}, \code{stan_data}, \code{fit},
\code{posterior_summary} (also in \code{postprocessing}), and \code{NULL} placeholders for
\code{summarized_data}/\code{person_day}.
}
\description{
End-to-end workflow for household transmission estimation via legacy MLE
or RSV/VL+Stan. Works with simulated or user-provided data.
}
\details{
Enforces valid engine/estimation pairs; other combinations error.
}
\seealso{
\code{\link{TransmissionChainAnalysis}}, \code{\link{postprocessing_estimates}},
\code{\link{build_stan_household_arrays}}, \code{\link{run_household_stan}}
}

% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mainpipeline.R
\name{main_parameter_estimation_pipeline}
\alias{main_parameter_estimation_pipeline}
\title{Main parameter estimation pipeline}
\usage{
main_parameter_estimation_pipeline(
  user_data = NULL,
  synthetic_data = TRUE,
  n_households = 10,
  n_runs = 10,
  hh.size = sample(3:7, 1),
  tests.per.week = 1,
  Covariates = FALSE,
  Covariates_list = c("Vaccination status", "Antibody Level"),
  Covariate_specifications = NULL,
  day_series_covariates = TRUE,
  series_cols = NULL,
  comm_covariate_cols = NULL,
  hh_covariate_cols = NULL,
  hh_by_role = FALSE,
  hh_role_covariate_cols = NULL,
  standardize_covariates = TRUE,
  lambda_comm = 0.01,
  lambda_hh = 0.01,
  p.comm.base.infant.fix = 0.002,
  p.comm.multiplier.sibling = 1,
  p.comm.multiplier.parent = 1,
  p.comm.multiplier.elder = 1,
  p.hh.base.infant = 0.2,
  p.hh.multiplier.sibling = 0.5267686,
  p.hh.multiplier.parent = 0.8008933,
  p.hh.multiplier.elder = 0.6008933,
  p.imm.base.sibling = 1e-10,
  p.imm.base.parent = 1e-10,
  p.imm.base.elder = 1e-10,
  partial.immunity.infant = 1e-10,
  partial.immunity.sibling = 1e-10,
  partial.immunity.parent = 1e-10,
  partial.immunity.elder = 1e-10,
  duration.latent = 1,
  duration.infect.inf = 2,
  multiplier.dur.sibpar = 0.5,
  p.detect = 0.999,
  amplitude = 2.6581 * 0,
  phase = -0.408,
  start_date = as.Date("2024-09-21"),
  end_date = as.Date("2025-04-17"),
  latent_par = list(shape = 2, scale = 1),
  report_par = list(shape = 1, scale = 1.5),
  infect_par = list(shape = 3, scale = 2),
  start_par = c(-6, 0.02, -2, rep(0, 6)),
  lambda = 0.01,
  lambda0 = 0.2,
  lambda_alpha = 5,
  delta0_true = qlogis(0.002),
  alpha0_true = qlogis(0.2)
)
}
\arguments{
\item{user_data}{List or data.frame. User-provided observations. If a list,
it should contain one data frame per household; if a single data.frame,
it must contain at least columns \code{HH}, \code{individual_ID}, \code{role},
\code{test_date}, \code{infection_status}, and \code{community_risk}.
Ignored when \code{synthetic_data = TRUE}. Default \code{NULL}.}

\item{synthetic_data}{Logical. If \code{TRUE} (default), simulate data using
\code{\link{generate_synthetic_data_standardized}} via
\code{\link{simulate_households}}; otherwise, convert \code{user_data} with
\code{\link{dataframe_to_household_list}}.}

\item{n_households}{Integer. Number of households to simulate (used only when
\code{synthetic_data = TRUE}). Default 10.}

\item{n_runs}{Integer. Number of repeated estimation runs. Default 10.}

\item{hh.size}{Integer. Household size for simulation. Default \code{sample(3:7,1)}.}

\item{tests.per.week}{Integer. Tests per person per week (1–3). Default 1.}

\item{Covariates}{Logical. If \code{TRUE}, generate additional covariates in simulation.}

\item{Covariates_list}{Character vector. Names of covariates to generate.}

\item{Covariate_specifications}{List. Per-covariate specifications; see
\code{\link{generate_synthetic_data_one}} for schema and defaults.}

\item{day_series_covariates}{Logical. If \code{TRUE}, build day-series list-columns
for covariates during summarization (see \code{\link{summarize_individuals}}).}

\item{series_cols}{Character vector or \code{NULL}. Names (pre-normalization) of covariates
to include as day-series; if \code{NULL}, uses all detected covariates.}

\item{comm_covariate_cols}{Character vector. Column names included in the community
risk model (no intercept).}

\item{hh_covariate_cols}{Character vector. Household covariates shared across roles.}

\item{hh_by_role}{Logical. If \code{TRUE}, allow role-specific household covariates.}

\item{hh_role_covariate_cols}{List. Named list with elements \code{infant},
\code{sibling}, \code{adult}, \code{elder}, each a character vector of columns;
falls back to \code{hh_covariate_cols} when missing.}

\item{standardize_covariates}{Logical. Z-score non-binary numeric columns in model matrices.}

\item{lambda_comm, lambda_hh}{Numeric. L2 penalties for community and household
covariate coefficients. Defaults 0.01.}

\item{p.comm.base.infant.fix}{Numeric. Baseline community infection probability per day for infants.}

\item{p.comm.multiplier.sibling, p.comm.multiplier.parent, p.comm.multiplier.elder}{Numeric multipliers applied to \code{p.comm.base.infant.fix} by role.}

\item{p.hh.base.infant}{Numeric. Baseline within-household transmission probability per infectious infant contact (per day).}

\item{p.hh.multiplier.sibling, p.hh.multiplier.parent, p.hh.multiplier.elder}{Multipliers relative to infant baseline by role.}

\item{p.imm.base.sibling, p.imm.base.parent, p.imm.base.elder}{Numeric. Baseline
(day-1) immunity probabilities by role.}

\item{partial.immunity.infant, partial.immunity.sibling, partial.immunity.parent, partial.immunity.elder}{Numeric. Breakthrough scaling (0–1) if previously immune, by role.}

\item{duration.latent}{Integer. Mean latent period (days).}

\item{duration.infect.inf}{Integer. Mean infectious duration for infants (days).
Other roles use \code{duration.infect.inf * multiplier.dur.sibpar}.}

\item{multiplier.dur.sibpar}{Numeric. Infectious duration multiplier for non-infant roles.}

\item{p.detect}{Numeric. Detection probability on testing days.}

\item{amplitude, phase}{Numeric. Seasonality parameters (cosine forcing) for community risk.}

\item{start_date, end_date}{Date. Simulation/analysis window (inclusive of \code{start_date}).}

\item{latent_par, report_par, infect_par}{Lists with elements \code{shape} and
\code{scale} for the latent delay, reporting delay, and infectious period gammas.}

\item{start_par}{Numeric vector. Initial parameter vector. If not tailored to the
covariate layout, it is resized internally when passed to the optimizer.}

\item{lambda}{Numeric. Base L2 penalty for \code{gamma} (age) and \code{z_*} (role offsets).}

\item{lambda0, lambda_alpha}{Numeric. Penalties pulling \code{delta0} and \code{alpha0}
toward \code{delta0_true} and \code{alpha0_true}.}

\item{delta0_true, alpha0_true}{Numeric anchors for the intercept penalties (logit scale).}
}
\value{
A list with elements:
\itemize{
\item \code{raw_simulation}: list of household data frames (simulated or user-provided).
\item \code{summarized_data}: individual-level summary table
(from \code{\link{summarize_individuals}} then \code{\link{infectious_time_imputation}}).
\item \code{person_day}: long person-day table (from \code{\link{build_person_day_table}}).
\item \code{estimates}: \eqn{n\_runs \times p} matrix of parameter estimates
(from \code{\link{running_parameter_estimation}}).
}
}
\description{
End-to-end pipeline that (i) obtains household testing data (either simulated
or user-supplied), (ii) summarizes individuals, (iii) imputes infection
timelines, (iv) expands to a person-day table, and (v) runs repeated
maximum-likelihood estimation with penalties.
}
\details{
When \code{synthetic_data = TRUE}, data are produced by
\code{\link{generate_synthetic_data_standardized}} via
\code{\link{simulate_households}}. When \code{FALSE}, \code{user_data} is converted
with \code{\link{dataframe_to_household_list}}. Covariate names are normalized to
snake_case during summarization.

Community intensity \code{cases_t} used by the person-day builder is generated
internally as a smoothed, scaled seasonal signal over the analysis window.
}
\examples{
\dontrun{
res <- main_parameter_estimation_pipeline(
  synthetic_data = TRUE,
  n_households = 20, n_runs = 5,
  hh.size = 4, tests.per.week = 2,
  delta0_true = qlogis(0.002), alpha0_true = qlogis(0.2)
)
str(res$estimates)
}

}
\seealso{
\code{\link{simulate_households}},
\code{\link{generate_synthetic_data_standardized}},
\code{\link{summarize_individuals}},
\code{\link{infectious_time_imputation}},
\code{\link{build_person_day_table}},
\code{\link{running_parameter_estimation}},
\code{\link{postprocessing_estimates}}
}
